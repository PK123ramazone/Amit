<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramazone Store</title>
    <style>
        :root {
            --primary-color: #3498db; /* Blue */
            --secondary-color: #2ecc71; /* Green */
            --accent-color: #f1c40f; /* Yellow */
            --text-color: #333;
            --heading-color: #2c3e50; /* Dark Blue/Grey for headings */
            --light-gray: #f8f9fa; /* Lighter background */
            --medium-gray: #e9ecef;
            --dark-gray: #555;
            --card-bg: #ffffff;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius-sm: 8px;
            --border-radius-md: 15px;
            --border-radius-lg: 25px;
            --shadow-sm: 0 2px 5px rgba(0,0,0,0.07);
            --shadow-md: 0 4px 15px rgba(0,0,0,0.1);
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            background-color: var(--light-gray);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .marquee-container {
            background-color: var(--accent-color);
            color: var(--text-color);
            padding: 12px 0;
            text-align: center;
            font-weight: bold;
            overflow: hidden;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
        }

        .marquee {
            display: inline-block;
            animation: marquee 20s linear infinite;
        }

        @keyframes marquee {
            from { transform: translateX(100%); }
            to { transform: translateX(-150%); }
        }

        .nav-buttons {
            display: flex;
            justify-content: space-around;
            background-color: var(--heading-color); /* Darker nav */
            padding: 8px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            box-shadow: var(--shadow-md);
        }

        .nav-buttons button {
            font-size: 15px;
            padding: 10px 25px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            flex-grow: 1;
            min-width: 140px;
            margin: 5px;
            border-radius: var(--border-radius-lg);
            transition: background-color 0.3s ease, transform 0.2s ease;
            color: white;
        }
        #homeButton { background-color: var(--primary-color); }
        #cartButton { background-color: var(--secondary-color); position: relative; }

        .nav-buttons button:hover {
            opacity: 0.85;
            transform: translateY(-2px);
        }
        
        .page-content { 
            padding: 0; 
        }
        .product-list-page, .cart-page, .product-detail-page-container { 
            display: none;
            padding: 20px; 
        }
        .product-list-page.active, .cart-page.active, .product-detail-page-container.active {
            display: block;
            animation: fadeInPage 0.5s ease-in-out;
        }
        @keyframes fadeInPage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .search-and-filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 25px 15px;
            gap: 20px;
            background-color: var(--card-bg);
            margin-bottom: 0; 
            border-bottom: 1px solid var(--medium-gray);
        }
        .search-bar-wrapper {
            position: relative;
            flex-grow: 1; 
            max-width: 450px;
        }
        .search-bar {
            width: 100%;
            padding: 12px 45px 12px 20px;
            font-size: 16px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius-lg);
            outline: none;
            box-shadow: var(--shadow-sm);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }
        .search-bar:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
        }
        .search-icon {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            cursor: pointer;
            opacity: 0.7;
        }
        .filter-container {
            flex-shrink: 0; 
        }
        .category-filter-select {
            padding: 12px 18px;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--medium-gray);
            font-size: 16px;
            min-width: 200px;
            background-color: white;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .category-filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
        }

        #productsGrid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
        }
        .product-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .product-card .product-image-container {
             width: 100%;
             height: 200px;
             overflow: hidden;
             cursor: pointer;
        }
        .product-card img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            transition: transform 0.3s ease;
        }
        .product-card:hover img {
            transform: scale(1.05);
        }
        .product-card .product-info {
            padding: 15px;
            text-align: center;
            flex-grow: 1;
        }
        .product-card .product-name {
            font-size: 1.15em;
            font-weight: 600;
            color: var(--heading-color);
            margin-bottom: 8px;
            cursor: pointer;
             white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .product-card .product-price { 
            color: var(--primary-color);
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .product-card .product-category-list {
            font-size: 0.9em;
            color: var(--dark-gray);
            margin-bottom: 12px;
        }
        .product-card .product-buttons {
            display: flex;
            gap: 10px;
            padding: 0 15px 15px 15px;
        }
        .product-buttons button {
            flex-grow: 1;
            padding: 10px 12px;
            font-size: 13px;
            border-radius: var(--border-radius-lg);
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.1s ease;
        }
        .product-buttons button.view-details-btn {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        .product-buttons button.view-details-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        .product-buttons button.add-to-cart-list-btn {
            background-color: var(--secondary-color);
            color: white;
            border: 2px solid var(--secondary-color);
        }
        .product-buttons button.add-to-cart-list-btn:hover {
            background-color: #27ae60; 
            border-color: #27ae60;
        }
        .product-buttons button.item-in-cart-style { /* Style for when item is in cart but button is active */
            background-color: var(--primary-color); /* Example: A different shade or style */
            color: white;
            border-color: var(--primary-color);
        }


        .product-detail-content { 
            max-width: 800px; 
            margin: 0 auto;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
        }
        .product-detail-layout { 
            display: flex;
            flex-direction: column; 
            gap: 25px;
        }
        .product-detail-content .detail-image-container {
            width: 100%;
            max-width: 350px; 
            margin: 0 auto 20px auto; 
            text-align: center;
             flex-shrink: 0;
        }
        .product-detail-content .detail-image-container img {
            width: 100%;
            height: auto;
            max-height: 380px;
            object-fit: contain;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
            cursor: zoom-in; /* Indicate image is clickable for zoom */
        }
        .product-detail-content-wrapper {
            flex-grow: 1;
        }
        #productInfoSection, #descriptionSection {
            padding: 20px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius-sm);
            background-color: var(--light-gray); 
            margin-bottom: 20px;
        }
        #productInfoSection .product-name {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--heading-color);
            margin-bottom: 10px;
        }
        #productInfoSection .product-price { 
            font-size: 1.5em;
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 10px;
        }
        #productInfoSection .product-category-detail {
            font-size: 1.1em;
            color: var(--dark-gray);
            margin-bottom: 15px;
            font-weight: 600;
        }
        #descriptionSection h3 {
            font-size: 1.3em;
            color: var(--heading-color);
            margin-bottom: 10px;
        }
        #descriptionSection p {
            font-size: 1em;
            color: var(--text-color);
            margin-bottom: 10px;
        }
        #descriptionSection .delivery-info {
            color: var(--secondary-color);
            font-weight: bold;
            margin-top: 15px;
        }
        button.add-to-cart-detail-btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: var(--border-radius-lg);
            display: inline-block; 
            margin-top: 15px;
        }
        button.add-to-cart-detail-btn:hover {
            background-color: #27ae60;
        }
        button.add-to-cart-detail-btn.item-in-cart-style {
             background-color: var(--primary-color);
        }


        .related-products-section { 
            margin-top: 30px;
        }
        .related-products-section h3 {
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            color: var(--heading-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            display: inline-block; 
            padding-bottom: 5px;
        }
        .related-products-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        .related-product-card .product-image-container { height: 150px; }
        .related-product-card .product-name { font-size: 1em; }
        .related-product-card .product-price { font-size: 1em; }
        .related-product-card .product-buttons button { font-size: 12px; padding: 8px 10px;}


        .cart-page h2 {
            text-align: center;
            font-size: 1.8em;
            color: var(--heading-color);
            margin-bottom: 25px;
        }
        .cart-item {
            display: flex; 
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
        }
        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--medium-gray);
             flex-shrink: 0;
        }
        .cart-item-details {
            flex-grow: 1;
        }
        .cart-item-details .product-name {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--heading-color);
        }
        .cart-item-details .product-price { 
            color: var(--secondary-color);
            font-size: 1em;
            font-weight: bold;
        }
        .quantity-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .quantity-buttons span {
            font-size: 1.1em;
            font-weight: bold;
            min-width: 25px;
            text-align: center;
        }
        .quantity-buttons button {
            padding: 6px 12px;
            border-radius: 50%; 
            background: var(--primary-color);
            color: white;
            font-size: 1em;
            line-height: 1; 
            width: 30px; height: 30px;
            display:flex; align-items:center; justify-content:center;
        }
        .quantity-buttons button:hover {
            background: #2980b9; 
        }
        .cart-total {
            margin-top: 30px;
            font-size: 1.4em;
            font-weight: bold;
            color: var(--heading-color);
            text-align: right; 
            padding: 15px;
            background-color: var(--medium-gray);
            border-radius: var(--border-radius-sm);
        }
        .buy-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 30px;
            font-size: 1.2em;
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 320px;
            margin: 30px auto 0 auto;
            display: block;
            text-align: center;
        }
        .buy-button:hover {
            background-color: #27ae60; 
        }
        .empty-cart-message, .no-products-message, .loading-message {
            text-align: center;
            font-size: 1.2em;
            color: var(--dark-gray);
            padding: 40px 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
        }

        .confirmation-dialog {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .confirmation-dialog.active {
            opacity: 1; pointer-events: auto;
        }
        .dialog-content {
            background: white; padding: 30px; border-radius: var(--border-radius-md); text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: scale(0.95); transition: transform 0.3s ease; width: 90%; max-width: 400px;
        }
        .confirmation-dialog.active .dialog-content {
            transform: scale(1);
        }
        .dialog-content p { font-size: 1.2em; font-weight: 600; margin-bottom: 25px; color: var(--heading-color); }
        .dialog-content button {
            margin: 0 10px; padding: 10px 25px; font-size: 1em; border-radius: var(--border-radius-lg);
        }
        .dialog-content button.confirm-yes { background-color: var(--secondary-color); color: white; }
        .dialog-content button.confirm-yes:hover { background-color: #27ae60; }
        .dialog-content button.confirm-no { background-color: #e74c3c; /* Red */ color: white; }
        .dialog-content button.confirm-no:hover { background-color: #c0392b; }

        .cart-badge {
            background-color: var(--accent-color); color: var(--text-color); font-weight: bold;
            font-size: 12px; border-radius: 50%; padding: 3px 7px;
            position: absolute; top: 5px; right: 8px;
            border: 1px solid var(--heading-color);
        }

        .loader-container { text-align: center; padding: 50px 20px; }
        .loader {
            border: 6px solid var(--medium-gray);
            border-top: 6px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
        }
        .loader-container p { font-size: 1.1em; color: var(--dark-gray); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Full Screen Image Modal */
        .image-modal {
            display: none; 
            position: fixed;
            z-index: 3000; 
            padding-top: 10px; /* Adjusted padding */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.95); 
            justify-content: center; 
            align-items: center; 
            animation: fadeInModalBg 0.3s ease;
        }
        @keyframes fadeInModalBg { from { background-color: rgba(0,0,0,0); } to { background-color: rgba(0,0,0,0.95); } }

        .image-modal-content {
            margin: auto;
            display: block;
            max-width: 95%;
            max-height: 95vh; 
            object-fit: contain; 
            animation-name: zoomInModal;
            animation-duration: 0.4s;
        }

        @keyframes zoomInModal {
            from {transform: scale(0.7); opacity: 0;}
            to {transform: scale(1); opacity: 1;}
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 45px; /* Larger close button */
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            line-height: 1;
        }
        .image-modal-close:hover,
        .image-modal-close:focus {
            color: #bbb;
            text-decoration: none;
        }

        @media (min-width: 768px) { 
            .product-detail-layout {
                flex-direction: row; 
            }
            .product-detail-content .detail-image-container {
                margin: 0; 
            }
        }

        @media (max-width: 767px) { 
            #productsGrid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
            .product-card .product-image-container { height: 160px; }
            .product-card .product-name { font-size: 1.05em; }
            .nav-buttons button { min-width: 120px; padding: 8px 18px; font-size: 14px; }
            .cart-item { flex-direction: column; align-items: flex-start; } 
            .cart-item img { width: 100px; height: 100px; margin-bottom:10px; align-self:center; }
            .quantity-buttons { margin-top: 10px; }
            .related-products-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }

        }
        @media (max-width: 480px) { 
            .product-list-page, .cart-page, .product-detail-page-container { padding: 10px; }
            .search-and-filter-container { flex-direction: column; gap: 15px; padding: 15px 10px; }
            .search-bar-wrapper { width: 100%; }
            .category-filter-select { width: 100%; min-width: unset; }
            #productsGrid { grid-template-columns: 1fr; gap: 15px; } 
            .product-card .product-image-container { height: 180px; } 
            .nav-buttons button { font-size: 13px; padding: 8px 12px; min-width: 100px; }
            .cart-badge { top: 3px; right: 5px; padding: 2px 5px; font-size: 11px;}
            .product-detail-content { padding: 15px; }
            #productInfoSection .product-name { font-size: 1.5em; }
            #productInfoSection .product-price { font-size: 1.3em; }
            .cart-page h2 { font-size: 1.5em; }
            .cart-total { font-size: 1.2em; text-align: center; }
            .buy-button { font-size: 1.1em; }
            .related-products-grid { grid-template-columns: 1fr; }
            .related-product-card .product-image-container { height: 180px; }
        }

    </style>
</head>
<body>
    <div class="marquee-container">
        <div class="marquee">Welcome to Ramazone Store! Shop your favorite products. EMI Available! Attractive Offers!</div>
    </div>

    <div class="nav-buttons">
        <button id="homeButton" onclick="showPage('homePage')">Home</button> 
        <button id="cartButton" onclick="showPage('cartPage')"> 
            Cart
            <span id="cartCount" class="cart-badge" style="display: none;">0</span>
        </button>
    </div>
    
    <div id="homePage" class="product-list-page active"> 
        <div class="search-and-filter-container">
            <div class="search-bar-wrapper">
                <input type="text" id="searchBar" class="search-bar" placeholder="Search products..." />
                <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" alt="Search Icon" class="search-icon">
            </div>
            <div class="filter-container">
                <select id="categoryFilter" class="category-filter-select">
                    <option value="">All Categories</option>
                </select>
            </div>
        </div>
        <div id="productsGrid"> 
            <div class="loader-container">
                <div class="loader"></div>
                <p>Loading products...</p>
            </div>
        </div>
    </div>

    <div id="detailPage" class="product-detail-page-container"> 
    </div>

    <div id="cartPage" class="cart-page">
        <h2>Your Cart</h2>
        <div id="cartItems"></div>
        <div class="cart-total" id="cartTotal"></div>
        <button class="buy-button" onclick="placeOrder()">Buy on WhatsApp</button>
    </div>

    <div id="confirmationDialog" class="confirmation-dialog">
        <div class="dialog-content">
            <p>Do you want to confirm this order?</p>
            <button class="confirm-yes" onclick="confirmOrder()">Yes</button>
            <button class="confirm-no" onclick="closeDialog()">No</button>
        </div>
    </div>

    <div id="imageModal" class="image-modal">
        <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
        <img class="image-modal-content" id="modalZoomImage">
    </div>


    <script>
        let allProducts = [];
        let cart = []; // filteredProducts is not explicitly needed if applyAllFilters reconstructs the list

        const API_URL = "https://script.google.com/macros/s/AKfycbyfUEn0zpnfCXmiqE3XiQWwh5XC6bqgB0jXiEkGtQKRZwVNOg2nKCfkCenXVadXIGna/exec";

        async function fetchProducts() {
            const productsGridDiv = document.getElementById('productsGrid');
            productsGridDiv.innerHTML = `
                <div class="loader-container">
                    <div class="loader"></div>
                    <p>Loading products...</p>
                </div>`;
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                
                if (result.status === "success" && Array.isArray(result.data)) {
                    allProducts = result.data.map((p, index) => ({
                        id: `prod_${index}_${Date.now()}`,
                        name: p.product_name,
                        price: p.emi,
                        description: p.product_description,
                        category: p.category,
                        image: p.picture_link
                    }));
                    populateCategoryFilter();
                    applyAllFilters(); 
                } else {
                    productsGridDiv.innerHTML = "<p class='no-products-message'>Failed to load products. Please try again later.</p>";
                }
            } catch (error) {
                console.error("Error fetching products:", error);
                productsGridDiv.innerHTML = "<p class='no-products-message'>Error loading products. Please check connection.</p>";
            }
        }

        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            if (!categoryFilter) return;

            const categories = [...new Set(allProducts.map(p => p.category))].sort();
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        function applyAllFilters() {
            const searchQuery = document.getElementById('searchBar').value.toLowerCase();
            const selectedCategory = document.getElementById('categoryFilter').value;
            let tempFiltered = [...allProducts];

            if (selectedCategory) {
                tempFiltered = tempFiltered.filter(product => product.category === selectedCategory);
            }

            if (searchQuery) {
                tempFiltered = tempFiltered.filter(product =>
                    product.name.toLowerCase().includes(searchQuery) ||
                    (product.description && product.description.toLowerCase().includes(searchQuery))
                );
            }
            generateProductList(tempFiltered);
        }
        
        document.getElementById('searchBar').addEventListener('input', applyAllFilters);
        document.getElementById('categoryFilter').addEventListener('change', applyAllFilters);


        function showPage(pageId) {
            window.scrollTo(0, 0);
            document.querySelectorAll('.product-list-page, .cart-page, .product-detail-page-container').forEach(el => el.classList.remove('active'));
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) { // Check if element exists
                pageToShow.classList.add('active');
            }


            if (pageId === 'homePage') {
                document.getElementById('searchBar').value = '';
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {
                    categoryFilter.value = ''; 
                }
                if (allProducts.length > 0) {
                     applyAllFilters(); 
                }
            } else if (pageId === 'cartPage') {
                generateCart();
            }
        }

        function generateProductList(productsToDisplay) {
            const productsGridDiv = document.getElementById('productsGrid');
            productsGridDiv.innerHTML = '';
            if (productsToDisplay.length === 0) {
                 productsGridDiv.innerHTML = "<p class='no-products-message'>No products found. Try different filters or search.</p>";
                 return;
            }

            productsToDisplay.forEach((product) => {
                const originalProductIndex = allProducts.findIndex(p => p.id === product.id);
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                productCard.innerHTML = `
                    <div class="product-image-container" onclick="viewProduct(${originalProductIndex})">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <div class="product-name" onclick="viewProduct(${originalProductIndex})">${product.name}</div>
                        <div class="product-price">EMI: ₹${product.price}</div>
                        <div class="product-category-list">Category: ${product.category}</div>
                    </div>
                    <div class="product-buttons">
                        <button class="view-details-btn" onclick="viewProduct(${originalProductIndex})">View Details</button>
                        <button class="add-to-cart-list-btn" id="list-add-to-cart-btn-${product.id}" onclick="addToCart(${originalProductIndex})">Add to Cart</button>
                    </div>
                `;
                productsGridDiv.appendChild(productCard);
                updateButtonState(product.id);
            });
        }

        function viewProduct(originalProductIndex) {
            window.scrollTo(0, 0);
            const product = allProducts[originalProductIndex];
            const detailPageContainer = document.getElementById('detailPage'); 
            
            if (!product) {
                detailPageContainer.innerHTML = "<p class='no-products-message'>Product not found!</p>";
                showPage('detailPage'); 
                return;
            }

            detailPageContainer.innerHTML = `
                <div class="product-detail-content"> 
                    <div class="product-detail-layout">
                        <div class="detail-image-container">
                            <img src="${product.image}" alt="${product.name}" onclick="openImageModal('${product.image}')">
                        </div>
                        <div class="product-detail-content-wrapper">
                            <div id="productInfoSection">
                                <h1 class="product-name">${product.name}</h1>
                                <div class="product-price">EMI: ₹${product.price}</div>
                                <div class="product-category-detail">Category: ${product.category}</div>
                            </div>
                            <div id="descriptionSection">
                                <h3>Description</h3>
                                <p>${product.description}</p>
                                <p class="delivery-info">🚚 Free Delivery Available!</p>
                                <button class="add-to-cart-detail-btn" id="detail-add-to-cart-btn-${product.id}" onclick="addToCart(${originalProductIndex})">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                </div> 
            `;
            showPage('detailPage'); 
            generateRelatedProducts(product.category, product.id, detailPageContainer.querySelector('.product-detail-content'));
            updateButtonState(product.id);
        }

        function generateRelatedProducts(currentCategory, currentProductId, parentElementForRelated) {
             if (!parentElementForRelated) {
                console.error("Parent element for related products not found.");
                return;
            }
            const existingRelatedDiv = parentElementForRelated.querySelector('.related-products-section');
            if (existingRelatedDiv) existingRelatedDiv.remove();

            const related = allProducts
                .filter(p => p.category === currentCategory && p.id !== currentProductId)
                .sort(() => 0.5 - Math.random())
                .slice(0, 4); 

            if (related.length === 0) return;

            const relatedProductsSectionDiv = document.createElement('div');
            relatedProductsSectionDiv.classList.add('related-products-section');
            let relatedProductsHTML = '<h3>Related Products</h3><div class="related-products-grid">';
            
            related.forEach(relProduct => {
                const originalRelatedIndex = allProducts.findIndex(p => p.id === relProduct.id);
                relatedProductsHTML += `
                    <div class="product-card related-product-card"> 
                        <div class="product-image-container" onclick="viewProduct(${originalRelatedIndex})">
                            <img src="${relProduct.image}" alt="${relProduct.name}">
                        </div>
                        <div class="product-info">
                            <div class="product-name" onclick="viewProduct(${originalRelatedIndex})">${relProduct.name}</div>
                            <div class="product-price">EMI: ₹${relProduct.price}</div>
                        </div>
                        <div class="product-buttons">
                             <button class="view-details-btn" onclick="viewProduct(${originalRelatedIndex})">Details</button>
                             <button class="add-to-cart-list-btn" id="related-add-to-cart-btn-${relProduct.id}" onclick="event.stopPropagation(); addToCart(${originalRelatedIndex})">To Cart</button>
                        </div>
                    </div>`;
            });
            relatedProductsHTML += '</div>';
            relatedProductsSectionDiv.innerHTML = relatedProductsHTML;
            parentElementForRelated.appendChild(relatedProductsSectionDiv); 
            related.forEach(relProduct => updateButtonState(relProduct.id));
        }
        
        function addToCart(originalProductIndex) {
            const productToAdd = allProducts[originalProductIndex];
            const existingCartItem = cart.find(item => item.product.id === productToAdd.id);

            if (existingCartItem) {
                existingCartItem.quantity += 1;
            } else {
                cart.push({ product: productToAdd, quantity: 1 });
            }
            updateButtonState(productToAdd.id);
            updateCartCountBadge();
            showCustomNotification(`"${productToAdd.name}" added to cart!`);
            if (document.getElementById('cartPage').classList.contains('active')) {
                generateCart();
            }
        }

        function updateButtonState(productId) {
            const cartItem = cart.find(item => item.product.id === productId);
            const buttons = document.querySelectorAll(
                `#list-add-to-cart-btn-${productId}, ` +
                `#detail-add-to-cart-btn-${productId}, ` +
                `#related-add-to-cart-btn-${productId}`
            );

            buttons.forEach(button => {
                button.disabled = false; // Ensure button is always enabled
                button.classList.remove('item-in-cart-style'); // Remove specific styling class first

                if (cartItem) {
                    button.innerHTML = `In Cart (${cartItem.quantity})`;
                    button.classList.add('item-in-cart-style'); // Add class for specific styling if item is in cart
                } else {
                    if (button.id.startsWith('list-add-to-cart-btn-')) {
                        button.innerHTML = 'Add to Cart';
                    } else if (button.id.startsWith('detail-add-to-cart-btn-')) {
                        button.innerHTML = 'Add to Cart';
                    } else if (button.id.startsWith('related-add-to-cart-btn-')) {
                         button.innerHTML = 'To Cart';
                    }
                }
            });
        }


        function updateCartCountBadge() {
            const cartCountBadge = document.getElementById('cartCount');
            const totalItemsInCart = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountBadge.innerHTML = totalItemsInCart;
            cartCountBadge.style.display = totalItemsInCart > 0 ? "inline-block" : "none";
        }

        function generateCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            const cartTotalDiv = document.getElementById('cartTotal');
            cartItemsDiv.innerHTML = '';

            if (cart.length === 0) {
                cartItemsDiv.innerHTML = "<p class='empty-cart-message'>Your cart is currently empty.</p>";
                cartTotalDiv.innerHTML = '';
                updateCartCountBadge();
                return;
            }

            let totalAmount = 0;
            cart.forEach((cartItem, cartIndex) => {
                const originalProductIndex = allProducts.findIndex(p => p.id === cartItem.product.id);
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('cart-item');
                itemDiv.innerHTML = `
                    <img src="${cartItem.product.image}" alt="${cartItem.product.name}" onclick="viewProduct(${originalProductIndex})">
                    <div class="cart-item-details">
                        <div class="product-name">${cartItem.product.name}</div>
                        <div class="product-price">EMI: ₹${cartItem.product.price}</div>
                    </div>
                    <div class="quantity-buttons">
                        <button onclick="changeQuantity(${cartIndex}, -1)">-</button>
                        <span>${cartItem.quantity}</span>
                        <button onclick="changeQuantity(${cartIndex}, 1)">+</button>
                    </div>
                `;
                cartItemsDiv.appendChild(itemDiv);
                totalAmount += cartItem.product.price * cartItem.quantity;
            });
            cartTotalDiv.innerHTML = `Total EMI: ₹${totalAmount}`;
            updateCartCountBadge();
        }

        function changeQuantity(cartIndex, delta) {
            const item = cart[cartIndex];
            item.quantity += delta;
            const productId = item.product.id; // Get product ID before potential splice

            if (item.quantity <= 0) {
                cart.splice(cartIndex, 1);
            }
            updateButtonState(productId); // Update button state for this product ID
            generateCart(); 
        }

        function showCustomNotification(message, type = 'success') { 
            let notificationDiv = document.getElementById('customNotification');
            if (!notificationDiv) {
                notificationDiv = document.createElement('div');
                notificationDiv.id = 'customNotification';
                document.body.appendChild(notificationDiv);
                 Object.assign(notificationDiv.style, {
                    position: 'fixed', bottom: '20px', left: '50%', transform: 'translateX(-50%)',
                    padding: '12px 20px', borderRadius: 'var(--border-radius-sm)', color: 'white',
                    zIndex: '3000', boxShadow: 'var(--shadow-md)', opacity: '0', transition: 'opacity 0.3s ease'
                });
            }
            notificationDiv.textContent = message;
            notificationDiv.style.backgroundColor = type === 'success' ? 'var(--secondary-color)' : '#e74c3c'; 
            notificationDiv.style.opacity = '1';
            setTimeout(() => {
                notificationDiv.style.opacity = '0';
            }, 3000);
        }


        function placeOrder() {
            if (cart.length === 0) {
                showCustomNotification('Your cart is empty!', 'error'); return;
            }
            document.getElementById('confirmationDialog').classList.add('active');
        }

        function closeDialog() {
            document.getElementById('confirmationDialog').classList.remove('active');
        }

        function confirmOrder() {
            closeDialog();
            if (cart.length === 0) { showCustomNotification('Your cart is empty!', 'error'); return; }

            const orderId = `ORD-${Date.now()}`;
            let message = `*🛍️ Ramazone Order*\n\n`;
            message += `*Order ID:* ${orderId}\n\n*Order Details:*\n`;
            let total = 0;
            cart.forEach((item, index) => {
                message += `${index + 1}. ${item.product.name} (EMI: ₹${item.product.price}) x ${item.quantity}\n`;
                total += item.product.price * item.quantity;
            });
            message += `\n*Total EMI Amount: ₹${total}*\n\nThank you for shopping with Ramazone! 😊`;

            const whatsappNumber = '917903698180';
            const whatsappLink = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappLink, '_blank');

            const cartProductIds = cart.map(item => item.product.id);
            cart = []; // Clear cart
            cartProductIds.forEach(productId => updateButtonState(productId)); // Reset buttons for cleared items
            
            showCustomNotification('Order confirmed and sent to WhatsApp!');
            generateCart(); 
            updateCartCountBadge(); 
            showPage('homePage'); 
        }

        // Full Screen Image Modal Functions
        function openImageModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalZoomImage');
            if (modal && modalImg) {
                modal.style.display = "flex"; 
                modalImg.src = imageUrl;
            }
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.style.display = "none";
            }
        }

        window.addEventListener('keydown', function (event) {
            if (event.key === 'Escape' && document.getElementById('imageModal').style.display === 'flex') {
                closeImageModal();
            }
        });
        // Optional: Close modal by clicking on the background (outside the image)
        document.getElementById('imageModal').addEventListener('click', function(event) {
            if (event.target === this) { // 'this' refers to the imageModal itself
                closeImageModal();
            }
        });


        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts().then(() => {
                 showPage('homePage'); 
            });
        });
    </script>
</body>
</html>
